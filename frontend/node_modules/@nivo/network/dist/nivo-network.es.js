import{memo as e,useState as n,useEffect as i,useMemo as o,useCallback as t,createElement as r,Fragment as d,forwardRef as a,useRef as c}from"react";import{useTheme as l,useMotionConfig as s,Container as u,useDimensions as v,SvgWrapper as f,ResponsiveWrapper as h,getRelativeCursor as k,getDistance as p}from"@nivo/core";import{animated as m,to as g,useTransition as y}from"@react-spring/web";import{jsx as C,Fragment as M}from"react/jsx-runtime";import{BasicTooltip as x,useTooltip as z}from"@nivo/tooltip";import{forceSimulation as b,forceLink as I,forceManyBody as S,forceCenter as N}from"d3-force";import{useInheritedColor as W}from"@nivo/colors";import{useAnnotations as B,Annotation as T,useComputedAnnotations as w,renderAnnotationsToCanvas as A}from"@nivo/annotations";function L(){return L=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},L.apply(this,arguments)}function D(e,n){if(null==e)return{};var i,o,t={},r=Object.keys(e);for(o=0;o<r.length;o++)i=r[o],n.indexOf(i)>=0||(t[i]=e[i]);return t}var E=e((function(e){var n=e.node,i=e.animated,o=e.onClick,t=e.onMouseEnter,r=e.onMouseMove,d=e.onMouseLeave;return C(m.circle,{"data-testid":"node."+n.id,transform:g([i.x,i.y,i.scale],(function(e,n,i){return"translate("+e+","+n+") scale("+i+")"})),r:g([i.size],(function(e){return e/2})),fill:i.color,strokeWidth:i.borderWidth,stroke:i.borderColor,opacity:i.opacity,onClick:o?function(e){return o(n,e)}:void 0,onMouseEnter:t?function(e){return t(n,e)}:void 0,onMouseMove:r?function(e){return r(n,e)}:void 0,onMouseLeave:d?function(e){return d(n,e)}:void 0})})),R=e((function(e){var n=e.link,i=e.animated,o=e.blendMode;return C(m.line,{"data-testid":"link."+n.id,stroke:i.color,style:{mixBlendMode:o},strokeWidth:n.thickness,strokeLinecap:"round",opacity:i.opacity,x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2})})),O={layers:["links","nodes","annotations"],linkDistance:30,centeringStrength:1,repulsivity:10,distanceMin:1,distanceMax:1/0,iterations:120,nodeSize:12,activeNodeSize:18,inactiveNodeSize:8,nodeColor:"#000000",nodeBorderWidth:0,nodeBorderColor:{from:"color"},linkThickness:1,linkColor:{from:"source.color"},isInteractive:!0,defaultActiveNodeIds:[],nodeTooltip:function(e){var n=e.node;return C(x,{id:n.id,enableChip:!0,color:n.color})},annotations:[],animate:!0,motionConfig:"gentle",role:"img"},P=L({},O,{nodeComponent:E,linkComponent:R,linkBlendMode:"normal"}),j=L({},O,{renderNode:function(e,n){e.fillStyle=n.color,e.beginPath(),e.arc(n.x,n.y,n.size/2,0,2*Math.PI),e.fill(),n.borderWidth>0&&(e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.stroke())},renderLink:function(e,n){e.strokeStyle=n.color,e.lineWidth=n.thickness,e.beginPath(),e.moveTo(n.source.x,n.source.y),e.lineTo(n.target.x,n.target.y),e.stroke()},pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1}),H=["index"],F=function(e){return o((function(){return"function"==typeof e?e:function(){return e}}),[e])},q=function(e){var r=e.center,d=e.nodes,a=e.links,c=e.linkDistance,s=void 0===c?O.linkDistance:c,u=e.centeringStrength,v=void 0===u?O.centeringStrength:u,f=e.repulsivity,h=void 0===f?O.repulsivity:f,k=e.distanceMin,p=void 0===k?O.distanceMin:k,m=e.distanceMax,g=void 0===m?O.distanceMax:m,y=e.iterations,C=void 0===y?O.iterations:y,M=e.nodeSize,x=void 0===M?O.nodeSize:M,z=e.activeNodeSize,B=void 0===z?O.activeNodeSize:z,T=e.inactiveNodeSize,w=void 0===T?O.inactiveNodeSize:T,A=e.nodeColor,E=void 0===A?O.nodeColor:A,R=e.nodeBorderWidth,P=void 0===R?O.nodeBorderWidth:R,j=e.nodeBorderColor,q=void 0===j?O.nodeBorderColor:j,G=e.linkThickness,J=void 0===G?O.linkThickness:G,K=e.linkColor,Q=void 0===K?O.linkColor:K,U=e.isInteractive,V=void 0===U?O.isInteractive:U,X=e.defaultActiveNodeIds,Y=void 0===X?O.defaultActiveNodeIds:X,Z=n(null),$=Z[0],_=Z[1],ee=n(null),ne=ee[0],ie=ee[1],oe=function(e){var n=e.linkDistance,i=e.centeringStrength,t=e.repulsivity,r=e.distanceMin,d=e.distanceMax,a=e.center,c=F(n),l=a[0],s=a[1];return o((function(){return{link:I().distance((function(e){return c(e.data)})).strength(i),charge:S().strength(-t).distanceMin(r).distanceMax(d),center:N(l,s)}}),[c,i,t,r,d,l,s])}({linkDistance:s,centeringStrength:v,repulsivity:h,distanceMin:p,distanceMax:g,center:r});i((function(){var e=d.map((function(e){return{id:e.id,data:L({},e),index:0,x:0,y:0,vx:0,vy:0}})),n=a.map((function(n){return{data:L({},n),index:0,source:e.find((function(e){return e.id===n.source})),target:e.find((function(e){return e.id===n.target}))}})),i=b(e).force("link",oe.link.links(n)).force("charge",oe.charge).force("center",oe.center).stop();return i.tick(C),_(e),ie(n),function(){i.stop()}}),[d,a,oe,C,_,ie]);var te=n(Y),re=te[0],de=te[1],ae=function(e){var n=e.size,i=e.activeSize,o=e.inactiveSize,r=e.color,d=e.borderWidth,a=e.borderColor,c=e.isInteractive,s=e.activeNodeIds,u=l(),v=F(n),f=F(r),h=F(d),k=W(a,u),p=t((function(e){var n=f(e.data);return{size:v(e.data),color:n,borderWidth:h(e.data),borderColor:k(L({},e,{color:n}))}}),[v,f,h,k]),m=F(i),g=t((function(e){var n=f(e.data);return{size:m(e.data),color:n,borderWidth:h(e.data),borderColor:k(L({},e,{color:n}))}}),[m,f,h,k]),y=F(o),C=t((function(e){var n=f(e.data);return{size:y(e.data),color:n,borderWidth:h(e.data),borderColor:k(L({},e,{color:n}))}}),[y,f,h,k]);return t((function(e){return c&&0!==s.length?s.includes(e.id)?g(e):C(e):p(e)}),[p,g,C,c,s])}({size:x,activeSize:B,inactiveSize:w,color:E,borderWidth:P,borderColor:q,isInteractive:V,activeNodeIds:re}),ce=o((function(){return null===$?null:$.map((function(e){return L({},e,ae(e))}))}),[$,ae]),le=l(),se=F(J),ue=W(Q,le),ve=o((function(){return null===ne||null===ce?null:ne.map((function(e){var n=e.index,i=D(e,H),o={id:i.source.id+"."+i.target.id,data:i.data,index:n,source:ce.find((function(e){return e.id===i.source.id})),target:ce.find((function(e){return e.id===i.target.id}))};return L({},o,{thickness:se(o),color:ue(o)})}))}),[ne,ce,se,ue]);return{nodes:ce,links:ve,activeNodeIds:re,setActiveNodeIds:de}},G=function(e){return{x:e.x,y:e.y}},J=function(e){return{size:e.size,width:e.size,height:e.size}},K=function(e,n){return B({data:e,annotations:n,getPosition:G,getDimensions:J})},Q=function(e){var n=e.links,i=e.linkComponent,t=e.blendMode,d=s(),a=d.animate,c=d.config,l=o((function(){return[function(e){return{x1:e.source.x,y1:e.source.y,x2:e.source.x,y2:e.source.y,color:e.color,opacity:0}},function(e){return{x1:e.source.x,y1:e.source.y,x2:e.target.x,y2:e.target.y,color:e.color,opacity:1}}]}),[]),u=l[0],v=l[1],f=y(n,{keys:function(e){return e.id},initial:v,from:u,enter:v,update:v,expires:!0,config:c,immediate:!a});return C(M,{children:f((function(e,n){return r(i,{key:n.id,link:n,animated:e,blendMode:t})}))})},U=function(e){var n=e.nodes,i=e.nodeComponent,d=e.onMouseEnter,a=e.onMouseMove,c=e.onMouseLeave,l=e.onClick,u=e.tooltip,v=e.setActiveNodeIds,f=e.isInteractive,h=s(),k=h.animate,p=h.config,m=o((function(){return[function(e){return{x:e.x,y:e.y,size:e.size,color:e.color,borderWidth:e.borderWidth,borderColor:e.borderColor,scale:0,opacity:0}},function(e){return{x:e.x,y:e.y,size:e.size,color:e.color,borderWidth:e.borderWidth,borderColor:e.borderColor,scale:1,opacity:1}},function(e){return{x:e.x,y:e.y,size:e.size,color:e.color,borderWidth:e.borderWidth,borderColor:e.borderColor,scale:0,opacity:0}}]}),[]),g=m[0],x=m[1],b=m[2],I=y(n,{keys:function(e){return e.id},initial:x,from:g,enter:x,update:x,leave:b,config:p,immediate:!k}),S=z(),N=S.showTooltipFromEvent,W=S.hideTooltip,B=t((function(e,n){N(r(u,{node:e}),n),v([e.id]),null==d||d(e,n)}),[N,u,v,d]),T=t((function(e,n){N(r(u,{node:e}),n),null==a||a(e,n)}),[N,u,a]),w=t((function(e,n){W(),v([]),null==c||c(e,n)}),[W,v,c]);return C(M,{children:I((function(e,n){return r(i,{key:n.id,node:n,animated:e,onMouseEnter:f?B:void 0,onMouseMove:f?T:void 0,onMouseLeave:f?w:void 0,onClick:f?l:void 0})}))})},V=function(e){var n=e.nodes,i=e.annotations,o=K(n,i);return C(M,{children:o.map((function(e,n){return C(T,L({},e),n)}))})},X=["isInteractive","animate","motionConfig","theme","renderWrapper"],Y=function(e){var n=e.width,i=e.height,t=e.margin,a=e.data,c=a.nodes,l=a.links,s=e.linkDistance,u=void 0===s?P.linkDistance:s,h=e.centeringStrength,k=void 0===h?P.centeringStrength:h,p=e.repulsivity,m=void 0===p?P.repulsivity:p,g=e.distanceMin,y=void 0===g?P.distanceMin:g,M=e.distanceMax,x=void 0===M?P.distanceMax:M,z=e.iterations,b=void 0===z?P.iterations:z,I=e.layers,S=void 0===I?P.layers:I,N=e.nodeComponent,W=void 0===N?P.nodeComponent:N,B=e.nodeSize,T=void 0===B?P.nodeSize:B,w=e.activeNodeSize,A=void 0===w?P.activeNodeSize:w,L=e.inactiveNodeSize,D=void 0===L?P.inactiveNodeSize:L,E=e.nodeColor,R=void 0===E?P.nodeColor:E,O=e.nodeBorderWidth,j=void 0===O?P.nodeBorderWidth:O,H=e.nodeBorderColor,F=void 0===H?P.nodeBorderColor:H,G=e.linkComponent,J=void 0===G?P.linkComponent:G,K=e.linkThickness,X=void 0===K?P.linkThickness:K,Y=e.linkColor,Z=void 0===Y?P.linkColor:Y,$=e.linkBlendMode,_=void 0===$?P.linkBlendMode:$,ee=e.annotations,ne=void 0===ee?P.annotations:ee,ie=e.isInteractive,oe=void 0===ie?P.isInteractive:ie,te=e.defaultActiveNodeIds,re=void 0===te?P.defaultActiveNodeIds:te,de=e.nodeTooltip,ae=void 0===de?P.nodeTooltip:de,ce=e.onMouseEnter,le=e.onMouseMove,se=e.onMouseLeave,ue=e.onClick,ve=e.role,fe=void 0===ve?P.role:ve,he=e.ariaLabel,ke=e.ariaLabelledBy,pe=e.ariaDescribedBy,me=v(n,i,t),ge=me.margin,ye=me.innerWidth,Ce=me.innerHeight,Me=me.outerWidth,xe=me.outerHeight,ze=q({center:[ye/2,Ce/2],nodes:c,links:l,linkDistance:u,centeringStrength:k,repulsivity:m,distanceMin:y,distanceMax:x,iterations:b,nodeSize:T,activeNodeSize:A,inactiveNodeSize:D,nodeColor:R,nodeBorderWidth:j,nodeBorderColor:F,linkThickness:X,linkColor:Z,isInteractive:oe,defaultActiveNodeIds:re}),be=ze.nodes,Ie=ze.links,Se=ze.activeNodeIds,Ne=ze.setActiveNodeIds,We={links:null,nodes:null,annotations:null};S.includes("links")&&null!==Ie&&(We.links=C(Q,{links:Ie,linkComponent:J,blendMode:_},"links")),S.includes("nodes")&&null!==be&&(We.nodes=C(U,{nodes:be,nodeComponent:W,onMouseEnter:ce,onMouseMove:le,onMouseLeave:se,onClick:ue,tooltip:ae,setActiveNodeIds:Ne,isInteractive:oe},"nodes")),S.includes("annotations")&&null!==be&&(We.annotations=C(V,{nodes:be,annotations:ne},"annotations"));var Be=o((function(){return{nodes:be||[],links:Ie||[],activeNodeIds:Se,setActiveNodeIds:Ne}}),[be,Ie,Se,Ne]);return C(f,{width:Me,height:xe,margin:ge,role:fe,ariaLabel:he,ariaLabelledBy:ke,ariaDescribedBy:pe,children:S.map((function(e,n){var i;return"function"==typeof e?C(d,{children:r(e,Be)},n):null!=(i=null==We?void 0:We[e])?i:null}))})},Z=function(e){var n=e.isInteractive,i=void 0===n?P.isInteractive:n,o=e.animate,t=void 0===o?P.animate:o,r=e.motionConfig,d=void 0===r?P.motionConfig:r,a=e.theme,c=e.renderWrapper,l=D(e,X);return C(u,{animate:t,isInteractive:i,motionConfig:d,renderWrapper:c,theme:a,children:C(Y,L({isInteractive:i},l))})},$=function(e){return C(h,{children:function(n){var i=n.width,o=n.height;return C(Z,L({width:i,height:o},e))}})},_=["theme","isInteractive","animate","motionConfig","renderWrapper"],ee=function(e){var n=e.width,d=e.height,a=e.margin,s=e.pixelRatio,u=void 0===s?j.pixelRatio:s,f=e.data,h=f.nodes,m=f.links,g=e.linkDistance,y=void 0===g?j.linkDistance:g,M=e.centeringStrength,x=void 0===M?j.centeringStrength:M,b=e.repulsivity,I=void 0===b?j.repulsivity:b,S=e.distanceMin,N=void 0===S?j.distanceMin:S,W=e.distanceMax,B=void 0===W?j.distanceMax:W,T=e.iterations,L=void 0===T?j.iterations:T,D=e.layers,E=void 0===D?j.layers:D,R=e.renderNode,O=void 0===R?j.renderNode:R,P=e.nodeSize,H=void 0===P?j.nodeSize:P,F=e.activeNodeSize,G=void 0===F?j.activeNodeSize:F,J=e.inactiveNodeSize,Q=void 0===J?j.inactiveNodeSize:J,U=e.nodeColor,V=void 0===U?j.nodeColor:U,X=e.nodeBorderWidth,Y=void 0===X?j.nodeBorderWidth:X,Z=e.nodeBorderColor,$=void 0===Z?j.nodeBorderColor:Z,_=e.renderLink,ee=void 0===_?j.renderLink:_,ne=e.linkThickness,ie=void 0===ne?j.linkThickness:ne,oe=e.linkColor,te=void 0===oe?j.linkColor:oe,re=e.annotations,de=void 0===re?j.annotations:re,ae=e.isInteractive,ce=void 0===ae?j.isInteractive:ae,le=e.defaultActiveNodeIds,se=void 0===le?j.defaultActiveNodeIds:le,ue=e.nodeTooltip,ve=void 0===ue?j.nodeTooltip:ue,fe=e.onClick,he=e.canvasRef,ke=c(null),pe=v(n,d,a),me=pe.margin,ge=pe.innerWidth,ye=pe.innerHeight,Ce=pe.outerWidth,Me=pe.outerHeight,xe=q({center:[ge/2,ye/2],nodes:h,links:m,linkDistance:y,centeringStrength:x,repulsivity:I,distanceMin:N,distanceMax:B,iterations:L,nodeSize:H,activeNodeSize:G,inactiveNodeSize:Q,nodeColor:V,nodeBorderWidth:Y,nodeBorderColor:$,linkThickness:ie,linkColor:te,isInteractive:ce,defaultActiveNodeIds:se}),ze=xe.nodes,be=xe.links,Ie=xe.activeNodeIds,Se=xe.setActiveNodeIds,Ne=K(ze,de),We=w({annotations:Ne}),Be=o((function(){return{nodes:ze||[],links:be||[],activeNodeIds:Ie,setActiveNodeIds:Se}}),[ze,be,Ie,Se]),Te=l();i((function(){if(null!==ke.current){ke.current.width=Ce*u,ke.current.height=Me*u;var e=ke.current.getContext("2d");e.scale(u,u),e.fillStyle=Te.background,e.fillRect(0,0,Ce,Me),e.translate(me.left,me.top),E.forEach((function(n){"links"===n&&null!==be?be.forEach((function(n){return ee(e,n)})):"nodes"===n&&null!==ze?ze.forEach((function(n){return O(e,n)})):"annotations"===n?A(e,{annotations:We,theme:Te}):"function"==typeof n&&null!==ze&&null!==be&&n(e,Be)}))}}),[ke,Ce,Me,me.left,me.top,u,E,Te,ze,be,O,ee,We,Be]);var we=t((function(e){if(ke.current&&null!==ze){var n=k(ke.current,e),i=n[0],o=n[1];return ze.find((function(e){return p(e.x,e.y,i-me.left,o-me.top)<=e.size/2}))}}),[ke,me,ze]),Ae=z(),Le=Ae.showTooltipFromEvent,De=Ae.hideTooltip,Ee=t((function(e){var n=we(e);n?(Le(r(ve,{node:n}),e),Se([n.id])):(De(),Se([]))}),[we,Le,ve,De,Se]),Re=t((function(){De(),Se([])}),[De,Se]),Oe=t((function(e){if(fe){var n=we(e);n&&fe(n,e)}}),[we,fe]);return C("canvas",{ref:function(e){ke.current=e,he&&"current"in he&&(he.current=e)},width:Ce*u,height:Me*u,style:{width:Ce,height:Me,cursor:ce?"auto":"normal"},onClick:ce?Oe:void 0,onMouseEnter:ce?Ee:void 0,onMouseLeave:ce?Re:void 0,onMouseMove:ce?Ee:void 0})},ne=a((function(e,n){var i=e.theme,o=e.isInteractive,t=void 0===o?j.isInteractive:o,r=e.animate,d=void 0===r?j.animate:r,a=e.motionConfig,c=void 0===a?j.motionConfig:a,l=e.renderWrapper,s=D(e,_);return C(u,{isInteractive:t,animate:d,motionConfig:c,theme:i,renderWrapper:l,children:C(ee,L({isInteractive:t},s,{canvasRef:n}))})})),ie=a((function(e,n){return C(h,{children:function(i){var o=i.width,t=i.height;return C(ne,L({width:o,height:t},e,{ref:n}))}})}));export{Z as Network,ne as NetworkCanvas,$ as ResponsiveNetwork,ie as ResponsiveNetworkCanvas,j as canvasDefaultProps,O as commonDefaultProps,P as svgDefaultProps,q as useNetwork,K as useNodeAnnotations};
//# sourceMappingURL=nivo-network.es.js.map
